$(function(){function e(e){$(e).on("click",".disabled",function(){$("#ajax-status").text("已经没有了。"),$("#ajax-status").show(),$("#ajax-status").fadeOut(2e3)})}function a(e){$("html, body").animate({scrollTop:$(e).offset().top-100},1e3)}$("#ajax-status").click(function(){$(this).hide()}),$(".disabled").click(function(){$("#ajax-status").text("已经没有了。"),$("#ajax-status").show(),$("#ajax-status").fadeOut(2e3)}),$("#send").click(function(){var e=$("#content").val(),a=e.replace(/\ +/g,"");if(""==e||""==a)return $("#content").val("").attr("placeholder","老大，我很饿...."),!1;$("#message-form").submit()});var i=[];$(".get-comments").click(function(){var a=$(this).parent().next();a.is(":hidden")?a.show():a.hide();var t=$(this).parent().attr("data-id");-1==$.inArray(t,i)&&($.ajax({type:"get",url:"/article/get-comments/"+t,dataType:"json",success:function(a){var i="";return $(a.comments).each(function(e,a){i+='<div><span class="author"><i class="fa fa-user" aria-hidden="true"></i> 匿名用户 &nbsp;&nbsp;<i>'+a.Created_at+"</i></span><p>"+a.Comment+"</p><hr></div>"}),$("#"+a.id).prev().html(i),1==a.all_page?void $("#"+a.id).children("div").hide():1==a.current_page?($("#"+a.id).children("div").children("span").removeClass("disabled"),$("#"+a.id).children("div").children(".comment-prev").addClass("disabled"),void e($("#"+a.id).children("div"))):a.current_page==a.all_page?($("#"+a.id).children("div").children("span").removeClass("disabled"),$("#"+a.id).children("div").children(".comment-next").addClass("disabled"),void e($("#"+a.id).children("div"))):void 0},error:function(e){console.log(e)}}),i.push(t))}),$(".comment-next, .comment-prev").click(function(){if(!$(this).is(".disabled")){var i=$(this).parent().parent().attr("id"),t=$(this).parent().parent().data("currpage");if($(this).is(".comment-next"))var n=Number(t)+1;else var n=Number(t)-1;$.ajax({type:"get",url:"/article/get-comments/"+i+"?page="+n,dataType:"json",success:function(i){var t="";return $(i.comments).each(function(e,a){t+='<div><span class="author"><i class="fa fa-user" aria-hidden="true"></i> 匿名用户 &nbsp;&nbsp;<i>'+a.Created_at+"</i></span><p>"+a.Comment+"</p><hr></div>"}),$("#"+i.id).prev().html(t),1==i.all_page?void $("#"+i.id).children("div").hide():1==i.current_page?($("#"+i.id).children("div").children("span").removeClass("disabled"),$("#"+i.id).children("div").children("a").text(i.current_page),$("#"+i.id).data("currpage",i.current_page),$("#"+i.id).children("div").children(".comment-prev").addClass("disabled"),e($("#"+i.id).children("div")),void a($("#"+i.id).parent().parent())):i.current_page>=i.all_page?($("#"+i.id).children("div").children("span").removeClass("disabled"),$("#"+i.id).children("div").children("a").text(i.current_page),$("#"+i.id).data("currpage",i.current_page),$("#"+i.id).children("div").children(".comment-next").addClass("disabled"),e($("#"+i.id).children("div")),void a($("#"+i.id).parent().parent())):void 0},error:function(e){console.log(e)}})}}),$(".btn-comment").click(function(){var e=$(this).prev().val(),a=$(this).parent().attr("id"),i=e.replace(/\ +/g,"");if(""==e||""==i)return $(this).prev().val("").attr("placeholder","请写下你的评论"),!1;$.ajax({type:"post",url:"/article/add-comment",headers:{"X-CSRF-TOKEN":$("input[name=_csrf]").val()},dataType:"json",data:{comment:e,article_id:a},success:function(e){$("#"+e.id).children("input").val(""),$("#"+e.id).prev().append('<div><span class="author"><i class="fa fa-user" aria-hidden="true"></i> 匿名用户 &nbsp;&nbsp;<i>'+e.created_at+"</i></span><p>"+e.comment+"</p><hr></div>");var a=$("#"+e.id).parent().prev().find("i:last");a.text(Number(a.text())+1)},error:function(e){console.log(e)}})})}),$(".btn-thx").click(function(){var e=$(this).children("i:last-child"),a=$(this).parent().attr("data-id");e.text(Number(e.text())+1),$(this).unbind("click"),$.get("/article/add-thank/"+a)});