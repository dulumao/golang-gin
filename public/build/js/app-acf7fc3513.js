$(function(){function e(e){$(e).on("click",".disabled",function(){$("#ajax-status").text("已经没有了。"),$("#ajax-status").show(),$("#ajax-status").fadeOut(2e3)})}function a(e){$("html, body").animate({scrollTop:$(e).offset().top-100},1e3)}$("#ajax-status").click(function(){$(this).hide()}),$(".disabled").click(function(){$("#ajax-status").text("已经没有了。"),$("#ajax-status").show(),$("#ajax-status").fadeOut(2e3)}),$("#send").click(function(){var e=$("#content").val(),a=e.replace(/\ +/g,"");if(""==e||""==a)return $("#content").val("").attr("placeholder","老大，我很饿...."),!1;$("#message-form").submit()});var t=[];$(".get-comments").click(function(){var a=$(this).parent().next();a.is(":hidden")?a.show():a.hide();var i=$(this).parent().attr("data-id");-1==$.inArray(i,t)&&($.ajax({type:"get",url:"/article/get-comments/"+i,dataType:"json",success:function(a){var t="";return $(a.comments).each(function(e,a){t+='<div><span class="author"><i class="fa fa-user" aria-hidden="true"></i> 匿名用户 &nbsp;&nbsp;<i>'+a.Created_at+"</i></span><p>"+a.Comment+"</p><hr></div>"}),$("#"+a.id).prev().html(t),1==a.all_page?void $("#"+a.id).children("div").hide():1==a.current_page?($("#"+a.id).children("div").children("span").removeClass("disabled"),$("#"+a.id).children("div").children(".comment-prev").addClass("disabled"),void e($("#"+a.id).children("div"))):a.current_page==a.all_page?($("#"+a.id).children("div").children("span").removeClass("disabled"),$("#"+a.id).children("div").children(".comment-next").addClass("disabled"),void e($("#"+a.id).children("div"))):void 0},error:function(e){console.log(e)}}),t.push(i))}),$(".comment-next, .comment-prev").click(function(){if(!$(this).is(".disabled")){var t=$(this).parent().parent().attr("id"),i=$(this).parent().parent().data("currpage");if($(this).is(".comment-next"))var n=Number(i)+1;else var n=Number(i)-1;$.ajax({type:"get",url:"/article/get-comments/"+t+"?page="+n,dataType:"json",success:function(t){var i="";return $(t.comments).each(function(e,a){i+='<div><span class="author"><i class="fa fa-user" aria-hidden="true"></i> 匿名用户 &nbsp;&nbsp;<i>'+a.Created_at+"</i></span><p>"+a.Comment+"</p><hr></div>"}),$("#"+t.id).prev().html(i),1==t.all_page?void $("#"+t.id).children("div").hide():1==t.current_page?($("#"+t.id).children("div").children("span").removeClass("disabled"),$("#"+t.id).children("div").children("a").text(t.current_page),$("#"+t.id).data("currpage",t.current_page),$("#"+t.id).children("div").children(".comment-prev").addClass("disabled"),e($("#"+t.id).children("div")),void a($("#"+t.id).parent().parent())):t.current_page>=t.all_page?($("#"+t.id).children("div").children("span").removeClass("disabled"),$("#"+t.id).children("div").children("a").text(t.current_page),$("#"+t.id).data("currpage",t.current_page),$("#"+t.id).children("div").children(".comment-next").addClass("disabled"),e($("#"+t.id).children("div")),void a($("#"+t.id).parent().parent())):void 0},error:function(e){console.log(e)}})}}),$(".btn-comment").click(function(){var e=$(this).prev().val(),a=$(this).parent().attr("id"),t=e.replace(/\ +/g,"");if(""==e||""==t)return $(this).prev().val("").attr("placeholder","请写下你的评论"),!1;$.ajax({type:"post",url:"/article/add-comment",headers:{"X-CSRF-TOKEN":$("input[name=_csrf]").val()},dataType:"json",data:{comment:e,article_id:a},success:function(e){$("#"+e.id).children("input").val(""),$("#"+e.id).prev().append('<div><span class="author"><i class="fa fa-user" aria-hidden="true"></i> 匿名用户 &nbsp;&nbsp;<i>'+e.created_at+"</i></span><p>"+e.comment+"</p><hr></div>");var a=$("#"+e.id).parent().prev().find("i:last");a.text(Number(a.text())+1)},error:function(e){console.log(e)}})}),$("#form-register").validate({rules:{"昵称":{required:!0,minlength:4,maxlength:15},"邮箱":{required:!0,email:!0},"密码":{required:!0,minlength:6},"密码确认":{required:!0,minlength:6,equalTo:"#re-password"}},messages:{"昵称":{required:"不能为空",minlength:"至少4个字符",maxlength:"最多15个字符"},"邮箱":{required:"不能为空",email:"请填写正确的格式 如：name@domain.com"},"密码":{required:"不能为空",minlength:"至少6位"},"密码确认":{required:"不能为空",minlength:"至少6位",equalTo:"两次密码不相同"}}}),$("#login").mouseenter(function(){$("#user-dropdown").show()}).mouseleave(function(){$("#user-dropdown").hide()}),$("#btn-login").click(function(){var e=$("#email").val(),a=$("#password").val();return""==e?($(this).prev().addClass("text-danger bg-danger").text("邮箱不能为空"),!1):/^[\w\-\.]+@[\w\-\.]+(\.\w+)+$/.test(e)?""==a?($(this).prev().addClass("text-danger bg-danger").text("密码不能为空"),!1):a.length<6?($(this).prev().addClass("text-danger bg-danger").text("密码长度至少6位字符"),!1):($(this).prev().removeClass("text-danger bg-danger").html('<i class="fa fa-spinner fa-spin fa-2x" aria-hidden="true"></i> 登录中...'),void $.ajax({type:"post",url:"/login",headers:{"X-CSRF-TOKEN":$("input[name=_csrf]").val()},dataType:"json",data:{email:e,password:a},success:function(e){if(""!=e.error)return $("#btn-login").prev().addClass("text-danger bg-danger").text(e.error),!1;window.location.reload()},error:function(e){$("#btn-login").prev().addClass("text-danger bg-danger").text(e.statusText)}})):($(this).prev().addClass("text-danger bg-danger").text("邮箱格式不对，如：name@domain.com"),!1)})}),$(".btn-thx").click(function(){var e=$(this).children("i:last-child"),a=$(this).parent().attr("data-id");e.text(Number(e.text())+1),$(this).unbind("click"),$.get("/article/add-thank/"+a)});